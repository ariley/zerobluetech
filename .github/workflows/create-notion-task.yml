name: Create Notion Task

on:
  workflow_dispatch:
    inputs:
      task_name:
        description: 'Task name (keep short)'
        required: true
      task_description:
        description: 'Task description (details)'
        required: false
        default: ''
      due_date:
        description: 'Due date (YYYY-MM-DD)'
        required: true
      priority:
        description: 'Priority (High, Medium, Low)'
        required: false
        default: 'Medium'

jobs:
  create-task:
    runs-on: ubuntu-latest
    steps:
      - name: Create Notion task
        run: |
          RESPONSE=$(curl -s -w "\n%{http_code}" -X POST "https://api.notion.com/v1/pages" \
            -H "Authorization: Bearer ${{ secrets.NOTION_API_KEY }}" \
            -H "Content-Type: application/json" \
            -H "Notion-Version: 2022-06-28" \
            -d '{
              "parent": { "database_id": "${{ secrets.NOTION_DATABASE_ID }}" },
              "properties": {
                "Task name": {
                  "title": [{ "text": { "content": "${{ github.event.inputs.task_name }}" } }]
                },
                "Description": {
                  "rich_text": [{ "text": { "content": "${{ github.event.inputs.task_description }}" } }]
                },
                "Status": {
                  "status": { "name": "Not started" }
                },
                "Due date": {
                  "date": { "start": "${{ github.event.inputs.due_date }}" }
                },
                "Priority": {
                  "select": { "name": "${{ github.event.inputs.priority }}" }
                }
              }
            }')

          HTTP_CODE=$(echo "$RESPONSE" | tail -n1)
          BODY=$(echo "$RESPONSE" | sed '$d')

          echo "HTTP Status: $HTTP_CODE"
          echo "Response: $BODY"

          if [ "$HTTP_CODE" != "200" ]; then
            echo "Error: Failed to create Notion task"
            exit 1
          fi

          echo "âœ… Task created successfully!"

