---
import BaseHead from '../components/BaseHead.astro'
import Header from '../components/Header.astro'
import Footer from '../components/Footer.astro'
import WPArticleSummary from '../components/WPArticleSummary.astro'
import { SITE_TITLE, SITE_DESCRIPTION, PAGE_SIZE } from '../config'
import { sortedPosts } from '@/js/util.js'

// Use import.meta.glob() to fetch all posts, and then sort them by date.
const postImportResult = import.meta.glob('../posts/*.{md,mdx}', { eager: true })
const posts = sortedPosts(Object.values(postImportResult))
const hasMorePosts = posts.length > PAGE_SIZE
---

<!DOCTYPE html>
<html lang="en">
	<head>
		<BaseHead title="Blog - ZeroBlue" description="FileMaker development tips, tricks, and news from ZeroBlue" />
		<style>
			main {
				max-width: 900px;
				margin: 0 auto;
				padding: 2rem 1rem;
			}
			.blog-posts {
				display: flex;
				flex-direction: column;
				gap: 2rem;
			}
			article {
				border-bottom: 1px solid #e5e5e5;
				padding-bottom: 2rem;
			}
			article:last-child {
				border-bottom: none;
			}
			.entry-header {
				margin-bottom: 0;
			}
			.entry-title {
				margin: 0 0 0.5rem 0;
				font-size: 1.75rem;
				line-height: 1.3;
				font-weight: 600;
			}
			.entry-title a {
				color: #333;
				text-decoration: none;
			}
			.entry-title a:hover {
				color: #667eea;
			}
			.entry-meta {
				color: #999;
				font-size: 0.9rem;
				margin: 0;
			}
			.entry-meta time {
				color: #999;
			}
			.navigation {
				margin-top: 3rem;
				padding-top: 2rem;
				border-top: 1px solid #e5e5e5;
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<h1>Blog</h1>
			<div class="blog-posts">
				{posts.slice(0, PAGE_SIZE).map((post) => (
					<WPArticleSummary page={post} maxWords={50} />
				))}
			</div>
			{hasMorePosts &&
			  <nav id="nav-below" class="navigation nav-below" role="navigation">
			    <h3 class="assistive-text">Post navigation</h3>
			    <div class="nav-next alignleft"></div>
			    <div class="nav-previous alignright"><a href="/page/2/">Older <span class="meta-nav">&rarr;</span></a></div>
			    <div class="clear-fix"></div>
			  </nav>}
		</main>
		<Footer />
	</body>
</html>
